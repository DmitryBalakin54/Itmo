## Play On Words

`game` `words` `socket`


### Правила игры в слова

Для тех кто пропустил всю жизнь - рассказываем вам правила игры в слова: 
* Игроки ходят по очереди 
* Каждый игрок должен назвать слово, которое начинается на последнюю букву слова оппонента
* Слова использовать повторно нельзя 
* Игра заканчивается, когда один из игроков не может подобрать новое слово

```text
A: dataset
B: test
A: theorem
B: metadata
```


### Условие

Вам нужно написать свой класс-клиент для игры в слова, который работает через socket соединение. Ваш клиент должен играть (и выигрывать) автоматически.
Клиент должен логгировать свои действия и получаемый ответ в консоль. Это проверяется в тестах, но формат достаточно свободный.  
Если кончились слова - клиент должен сдаться. При проигрыше программа должна закончится с ошибкой. При прерывании через `Control+C` должно отправить команду завершения игры и закончится с ошибкой. 

Основной класс-сервер уже написан за вас и будет подниматься в тестах.  
В публичных тестах написано несколько простых серверов (см `socket_test_servers`), но в приватных тестах против вас будет подниматься настоящий монстр, который знает аж.. **N Слов** (случайно выбранных)!  
Вы можете написать свой сервер для тестирования клиента (да и просто для интереса) в файлике `server.py` и раскомментить соответствующий тест.  
В приватных тестах будет ровно такой же тест, то с готовым сервером. 

Для простоты мы немного упросим правила самой игры: 
* Играем английскими словами из списка [MIT 10k wordlist](https://www.mit.edu/~ecprice/wordlist.10000)  
  Вам нужно скачать эти слова самостоятельно и положить в файл в папку. Во время тестов у вас может не быть интернета;
* Используются только слова, которые больше 3х символов;
* Сервер контролирует правила игры и использованные слова; считается что сервер всегда играет правильно;
* Клиент должен помнить сыгранные слова и играть только новые  
  (не забывайте, что слова, которые сыграл сервер тоже нельзя играть повторно)
* Игру начинает сервер с приветствия и первого слова.


### Протокол

Для взаимодействия между клиентом-сервером мы придумываем свой протокол поверх socket соединения. 
Давайте назовём его `WGTP - Word Game Transfer Protocol`.

Наш `WGTP` является простым текстовым протоколом и пересылает просто строки с командами. Выглядит он так:
```text
Client -> Server
    PLAY <word>  (ход клиента; слово должно быть новое)
    SURRENDER  (клиент сдаётся когда не может сыграть новое слово)
    QUIT  (завершение игры; отправляется при получении control+c/kill-sig)

Server -> Client
    WELCOME  (сервер отправляет это при подключении)
    VALID  (ответ на валидное слово в PLAY)
    NOT_VALID <text>  (сообщение об ошибке на не валидное слово в PLAY)
    PLAY <word>  (ход сервера; слово гарантированно верное)
    PLAYER_VICTORY  (сервер сдаётся, игрок победил, игра закончена)
    PLAYER_DEFEAT  (сервер выиграл, игрок проиграл, игра закончена)
    MESSAGE <text>  (произвольное сообщение от сервера)
```
Причем каждая команда заканчивается переводом строки `\n`.


Далее пример общения клиента (`C:`) и сервера (`S:`):
```text
S: WELCOME
S: PLAY hello
C: PLAY orange
S: VALID
S: PLAY effect
C: PLAY eradjdsgauejd123asd
S: NOT_VALID Word "eradjdsgauejd123asd" is not exist
C: PLAY effect
...
C: PLAY jump
S: PLAYER_VICTORY
```
Или ситуация с проигрышем клиента
```text
S: WELCOME
S: PLAY hello
C: PLAY orange
...
C: SURRENDER
S: PLAYER_DEFEAT
```
 

### Тестирование и разработка 

В папке `socket_test_servers` содержатся несколько серверов на которых вы можете тестировать свою программу (они же запускаются в публичных тестах).  
Или вы можете аналогично написать и запустить свой сервер в файле `server.py`.

Запустив сервер он будет работать пока вы его не остановите и принимать коннекшены от клиентов 
```shell
python socket_test_servers/first_step_lose_server.py --port=59898
```

С работающим сервером вы можете запустить свой клиент, который бы играл с ним
```shell
python client.py --port=59898
```

Командами (одной из двух) можно поглядеть занятые порты и если что убить что-то лишнее
```shell
lsof -i -P -n | grep LISTEN | grep python
netstat -tulpn | grep LISTEN | grep python
```

### Заметки

1. Вам практически не дан шаблон решения в этой задачке. 
   Дело в том, что подключение к сокет-соединению делается в 2 строчки и если поместить их в шаблон, то в задаче нечего делать.
   Опирайтесь на примеры из документации питон.

2. Помните, что читая из потока определенное количество байт вы можете получить половину команды, 2 команды, 3.5 команд и тд.  
   Или обрабатывайте этот кейс или используйте `sock.makefile('r')`

3. В тестовых серверах используется `argparse` для совместимости со всем. Рекомендуем пользоваться вместо него `click`.

4. Во время тестов fixture `free_port` из `conftext.py` будет подбирать свободный порт. Сервер и клиент должны быть запущены на нём, это будет входом скрипта (см тесты) 


### Полезные ссылки 

* [socketserver](https://docs.python.org/3/library/socketserver.html#module-socketserver)
* [socket](https://docs.python.org/3/library/socket.html?highlight=socket#module-socket)
